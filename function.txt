This is function version 2.